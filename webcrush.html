<!doctype html>
<!--
  Webcrush is a utility for minifying and compressing HTML.

  Crushing an HTML file discourages casual inspection of the code,
  which may be useful, e.g., for posting a student problem-set
  project without broadcasting homework spoilers on the web.

  Two options are on this page:
  * LZ compression is optional, on by default.  Unchecking this
    can result in smaller files when LZ overhead dominates.
  * Absolute-url scripts (such as CDN scripts) can be pulled
    out of the LZ compressed code, on by default.  Chrome
    warns about huge performance penalties when CDN scripts
    are generated by document.write, this avoids that warning.

  Note that crushing is not a good method for hiding true secrets
  in HTML, because it is easy to decompress and reveal the code.
  This compression is more for obfuscation than for space-savings.
  Crushing can grow short documents, because the code is expressed
  in base64 (which grows 25%) and LZ decompression code must be
  packaged in the document (which adds 473 bytes). It is better
  to rely on HTTP gzip encoding for saving bandwidth.

  Compression is by Sam Hocevar's lz-string.  Minification is by
  Juriy Zaytsev's HTML minifier, which in turn relies on the awesome
  UglifyJS by Mihai Bazon and CleanCss by Jakub Pawlowicz.
-->
<html>

<head>
<meta charset="utf-8">
<title>Webcrush</title>
<link rel="stylesheet" href=
  "https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.css">
<script src=
  "https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="js/webcrush.js"></script>
<style>
h1 { margin-top: 20px; }
textarea { font: 8pt monospace; }
</style>
</head>
<body>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1>Webcrush HTML compression</h1>
      <p>Paste your HTML here to minify the markup, inline JS and CSS,
      <nobr><input type="checkbox" id="lz" checked> apply LZ
      compression,</nobr> and
      <nobr><input type="checkbox" id="src" checked> leave absolute-url
      scripts</nobr> in the clear.
      <span id="message"><a href="https://github.com/davidbau/webcrush"
          >About this.</a></span>
      <center>
        <input type="button" value="Crush it!" id="go" class="btn btn-primary">
      </center>
      </p>
      <textarea id="code" style="height:80vh;width:100%"></textarea>
    </div>
  </div> <!-- class="row" -->
</div> <!-- class="container" -->

</body>

</html>

<script>
var state = {
  didcrush: false,
  original: null
};

function recrush() {
  var uncrushed = state.original;
  if (!uncrushed) {
    return;
  }
  var crushed = webcrush.packhtml(uncrushed, {
    lzCompress: $('#lz').prop('checked'),
    writeOffDomainScripts: !$('#src').prop('checked')
  });
  // If already compressed and getting longer, then don't crush.
  if (uncrushed.length < crushed.length &&
      uncrushed.indexOf(webcrush.decompressor) >= 0) {
    crushed = uncrushed;
  } else {
    $('#message').text('Before ' + uncrushed.length +
        ' bytes; after: ' + crushed.length + ' bytes. ');
  }
  $('#code').val(crushed).select();
}

$(document).on('click', '#go', function() {
  if (state.didcrush) {
    $('#code').val(state.original);
    state.didcrush = false;
    $('#go').val('Crush it!');
    $('#message').text('');
  } else {
    state.original = $('#code').val();
    if (state.original) {
      state.didcrush = true;
      $('#go').val('Uncrush');
      recrush();
    }
  }
});

$(document).on('change', 'input[type=checkbox]', function() {
  if (state.didcrush) {
    recrush();
  }
});

$(document).on('input change', 'textarea', function() {
  if (state.didcrush) {
    state.didcrush = false;
    $('#go').val('Crush it!');
    $('#message').text('');
  }
});
</script>

